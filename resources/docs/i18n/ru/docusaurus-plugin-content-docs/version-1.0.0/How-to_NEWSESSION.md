---
title: 'How-to: NEWSESSION'
---

## Пример 1

### Условие

Есть заказ, для которого задана номер и признак того, является ли он проведенным.

import {CodeSample} from './CodeSample.mdx'

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseNewSession&block=sample1"/>

Нужно создать действие, которое проведет его в отдельной сессии изменений, и добавить его на форму со списком заказов .

### Решение

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseNewSession&block=solution1"/>

Если не "оборачивать" действие по установлению свойства **isPosted** в оператор [NEWSESSION](NEWSESSION_operator.md), то во время выполнения оператора [APPLY](APPLY_operator.md) в базу данных будут записаны также другие изменения, возможно сделанные на форме **orders**.

## Пример 2

### Условие

Аналогично **Примеру 1**, только для заказа определена форма его редактирования.

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseNewSession&block=sample2"/>

Нужно создать действие, которое создаст новый заказ и откроет форму по его редактированию. Это действие нужно добавить на форму со списком заказов.

### Решение

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseNewSession&block=solution2"/>

Если не использовать оператор **NEWSESSION**, то объект нового заказа будет создан в [сессии изменений](Change_sessions.md) формы **orders**. При этом если пользователь закроет форму не сохранив, то изменения "останутся" в сессии изменений формы, и созданный заказ будет отображен в форме со списком заказов.

## Пример 3

### Условие

Аналогично **Примеру 2**, только для заказа доступна возможность отметки.

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseNewSession&block=sample3"/>

Нужно создать действие, которое удалит отмеченные заказы и сразу сохранит изменения в базу данных (без необходимости нажимать пользователю кнопку Сохранить).

### Решение

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseNewSession&block=solution3"/>

По умолчанию, в новой сессии не учитываются изменения, сделанные в "верхней" сессии. Для того, чтобы свойство selected было доступно в новой сессии нужно использовать конструкцию **NESTED**. Без нее в свойстве **selected** всегда будет NULL. Кроме того, вместо указания конкретных свойств можно использовать конструкцию **NESTED LOCAL**. В этом случае будут доступны изменения всех локальных свойств верхней сессии.

## Пример 4

### Условие

Аналогично **Примеру 2**, только добавлена логика платежей по заказу.

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseNewSession&block=sample4"/>

Нужно создать кнопку на форме, которая откроет отдельную форму по редактированию платежей в этом заказе.

### Решение

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseNewSession&block=solution4"/>

При использовании [оператора NESTEDSESSION](NESTEDSESSION_operator.md) все изменения, сделанные в "верхней" сессии изменений, будут доступны во вложенной сессии. Если пользователь закроет форму, не нажав ОК, то все изменения, сделанные непосредственно в форме, пропадут. Если пользователь нажмет ОК, то изменения будут записаны не в базу данных, а в "верхнюю" сессию изменений. В базу данных они запишутся вместе с изменениями сделанными в основной форме **orders**.

Использовать **NEWSESSION** в данном случае нельзя хотя бы потому, что при создании нового заказа, которого еще нету в базе данных, форма **orderPayments** не сможет увидеть этого заказа (так как во вложенной сессии не видны изменения "верхней"), и поведение будет непредсказуемым.

Если вообще не использовать никакого оператора по управлению сессиями, то если пользователь изменит что-то на форме **orderPayments** и нажмет кнопку Закрыть, изменения все равно "сохранятся", хотя он может ожидать другого поведения.
