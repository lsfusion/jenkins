---
title: 'How-to: FORMULA'
---

## Пример 1

### Условие

Задан список заказов.

import {CodeSample} from './CodeSample.mdx'

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseFormula&block=sample1"/>

Необходимо экспортировать в CSV этот список, причем дату экспортировать в формате ISO (YYYY-MM-DD).

### Решение

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseFormula&block=solution1"/>

Для решения задачи создаем свойство при помощи оператора [FORMULA](FORMULA_operator.md), которое будет принимать на вход дату и возвращать значение в виде строки в формате YYYY-MM-DD. В выражении формулы используется стандартная функция PostgreSQL [to\_char](https://www.postgresql.org/docs/11/functions-formatting.html).

## Пример 2

### Условие

Аналогично **Примеру 1**. Также добавлены строки заказов с параметрами количество и сумма.

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseFormula&block=sample2"/>

Нужно выгрузить по одному заказу CSV-файл с его строками, в котором количества и суммы будут отформатированы до 3х и 2х знаков соответственно. Кроме того, нужно чтобы числа разбивались по триадам.

### Решение

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseFormula&block=solution2"/>

Создаем свойство toString, которое принимает на вход два параметра (число и формат) и возвращает значение типа **TEXT**. При выгрузке передаем нужный формат в качестве второго параметра.

## Пример 3

### Условие

Аналогично **Примеру 2**.

Нужно сделать колонку, которая будет отмечена, если в номере заказа находятся одни цифры.

### Решение

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseFormula&block=solution3"/>

Так как внутри формулы используются одинарные кавычки, то их требуется [экранировать](https://ru.wikipedia.org/wiki/%D0%AD%D0%BA%D1%80%D0%B0%D0%BD%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5_%D1%81%D0%B8%D0%BC%D0%B2%D0%BE%D0%BB%D0%BE%D0%B2) при помощи обратного слэша **\\**.

Важно заметить, что в платформе тип **BOOLEAN** имеет 2 значения : **TRUE** и **NULL**. Поэтому нельзя просто написать логическое выражение, а необходимо отрицательное значение преобразовывать в **NULL**. Кроме того, платформа должна в явную знать, что выражение может возвращать неопределенное значение. Для этого используется соответствующий маркер после ключевого слова **FORMULA**.

На уровне базы данных тип **BOOLEAN** хранится как числовое значение (1 или null), поэтому свойства этого типа должны возвращать числовое значение. Разработчик сам несет ответственность за то, чтобы возвращаемый тип выражения соответствовал указанному типу. В случае каких-либо расхождение поведение будет непредсказуемым (чаще всего будут происходить ошибки выполнения запросов).

Следует помнить ,что если на вход любому из свойств, построенных оператором **FORMULA**, передается **NULL**, то результатом всегда будет также **NULL**.

  
