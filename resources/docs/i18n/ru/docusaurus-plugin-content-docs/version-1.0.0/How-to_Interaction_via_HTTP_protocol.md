---
title: 'How-to: Взаимодействие через HTTP-протокол'
---

## Пример 1

### Условие

Задан некоторый набор городов, привязанных к странам.

import {CodeSample} from './CodeSample.mdx'

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseExternal&block=sample1"/>

Нужно отправить на определенный url HTTP-запрос на добавление города в формате JSON.

### Решение

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseExternal&block=solution1"/>

Оператор [EXPORT](Data_export_EXPORT_.md) создаст JSON в формате [FILE](Built-in_classes.md) и сохранит его в свойство exportFile. Пример сформированного файла : 

    {"countryId":"123","name":"San Francisco"}

Дальше вызывается оператор [EXTERNAL](Access_to_an_external_system_EXTERNAL_.md), который делает запрос на предопределенный url, передавая туда в качестве Body содержимое сформированного файла. В данном случае, так как свойство в блоке FROM имеет тип JSON, то в качестве типа контента будет использоваться *application/json*. В url'е закодированы <пространство имен\>.<имя свойства\>. В данном случае пространство именем модуля вызываемого свойства **createCity** является **Location**. Все параметры передаются по порядку с идентификатором **p**.  Ответ, который будет получен от сервера, будет записан в свойство **result**. Предположим, что ответ получен в формате JSON и имеет один из следующих видов :

    {"code":"0","message":"OK"}

    {"code":"1","message":"Некорректный код страны"}

Ответ разбирается при помощи оператора [IMPORT](Data_import_IMPORT_.md), который раскладывает соответствующие параметры в свойства **code** и **message** соответственно. В случае ошибки пользователю выдается сообщение с текстом ошибки.

## Пример 2

### Условие

Аналогично **Примеру 1**. 

Нужно принять соответствующий HTTP-запрос и создать новый город в базе данных с параметрами запроса.

### Решение

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseExternal&block=solution2"/>

Так как свойство имеет название **createCity** и расположено в [модуле](Modules.md) с пространством имен **Location**, то url, на котором будет принят запрос, имеет следующий вид :

    http://localhost:7651/exec?action=Location.createCity

Body HTTP-запроса будет передан параметром с типом **FILE**. В локальные свойства **cy** и **ne**, считываются значения из параметров **countryId** и **name** соответственно.

Если не находится страна с соответствующим кодом, то формируется JSON файл с содержанием, описанном в предыдущем примере, и вызывается оператор [RETURN](Exit_RETURN_.md), чтобы прервать выполнение. В качестве ответа, по умолчанию, используется значение, хранящееся в свойстве **exportFile**.

В случае, если все действия были завершены успешно, то формируется соответствующий ответ с сообщение ОК.

## Пример 3

### Условие

Задана логика заказов книг.

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseExternal&block=sample3"/>

Нужно отправить на определенный url HTTP-запрос на создание заказа в формате JSON.

### Решение

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseExternal&block=solution3"/>

Для создания JSON с вложенными тэгами нужно создать форму с соответствующими объектами, связанными через конструкцию **FILTERS**. На основе зависимостей между ними создается JSON с соответствующей структурой. В данном случае, JSON будет выглядеть следующим образом :

    {
       "dt":"20.08.18",
       "nm":"1",
       "detail":[
          {
             "pr":5.99,
             "id":"b1",
             "qn":3
          },
          {
             "pr":6.99,
             "id":"b2",
             "qn":2
          }
       ]
    }

Для order не создается свой тэг, так как значение объекта передается параметром для оператора **EXPORT**.  
В данном примере, ответ полученный на HTTP-запрос игнорируется.

## Пример 4

### Условие

Аналогично **Примеру 3**. 

Нужно принять соответствующий HTTP-запрос и создать новый заказ в базе данных с параметрами запроса.

### Решение

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseExternal&block=solution4"/>

Для импорта соответствующего файла в формате JSON создается форма аналогичной структуры, только в качестве классов объектов используется тип INTEGER. При импорте значения тэгов будут помещены в свойства с соответствующими именами. Свойства **date** и **number** не имеют параметров, так как в JSON значения для них идут на самом верхнем уровне.

## Пример 5

### Условие

Аналогично **Примеру 4**. 

Нужно отправить на определенный url HTTP-запрос на создание заказа в формате JSON, аналогичный предыдущему примеру, только обернуть все в тэг **order**.

### Решение

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseExternal&block=solution5"/>

  

В отличии от предыдущего примера создаем [группу](Groups_of_properties_and_actions.md) **order**, при помощи оператора [GROUP](GROUP_operator.md). При объявлении формы в эту группу записываем все свойства для заказа и объект detail. Результирующий JSON будет выглядеть следующим образом :

    {
       "order":{
          "dt":"20.08.18",
          "nm":"1",
          "detail":[
             {
                "pr":5.99,
                "id":"b1",
                "qn":3
             },
             {
                "pr":6.99,
                "id":"b2",
                "qn":2
             }
          ]
       }
    }

## Пример 6

### Условие

Аналогично **Примеру 5**. 

Нужно принять соответствующий HTTP-запрос и создать новый заказ в базе данных с параметрами запроса.

### Решение

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseExternal&block=solution6"/>

Точно также как и при экспорте, добавляем все свойств и объект **detail** в группу order для корректного приема новой версии JSON.

## Пример 7

### Условие

Аналогично **Примеру 3**. 

Нужно по HTTP GET запросу, в котором задана дата, вернуть список номеров заказов от этой даты.

### Решение

<CodeSample url="https://ru-documentation.lsfusion.org/sample?file=UseCaseExternal&block=solution7"/>

Url, на который следует слать HTTP запрос, будет выглядеть следующим образом :  http://localhost:7651/exec?action=Location.getOrdersByDate&p=12.11.2018 .

В ответ будет возвращен, например, следующий JSON :

  

    {
        "order": [
            {
                "nm": "42"
            },
            {
                "nm": "65"
            }
        ]
    }
